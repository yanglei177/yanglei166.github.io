<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="../images/logo5.ico"/>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <title>我的询价单</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/base.css">
  </head>
<body>           
	<section class="liststatus bg_gradient bor_no">
    	<ul id="xjdul"></ul>  
        <h2 class="viewmore"><div class="arrimg"></div>查看更多</h2>
        <p class="tc mar_t_15 dis_none bold font14" id="xjd">您暂无询价单记录</p>
    </section>
<div id="loadingbox"></div>    
<script src="../js/jquery-2.1.4.min.js"></script>
<script src="../js/common.js"></script>
<script type="text/javascript">
$(function(){
	var uid = window.localStorage.getItem("uid");
	if(!uid){
		alert("您还没有注册登录，请先注册。");
		location.href = "register.html?url=mybill.html";
		return ;
	}
	
	var reqData = "uid=" + localStorage.getItem("uid");				
	baopRequest.sendData("inquerySheet/listForPage", reqData, function(data){
		if (data.code == 0) {
			if(data.page.totalPage == 1){
				$(".viewmore").hide();
			}else if(data.page.totalPage == 0){$("#xjd").show();$(".viewmore").hide();}
			var liHtml = "";
			for(var i=0;i<data.page.list.length;i++){
				var aXz = ["交强险","商业险"], sXz = "", status = "", statusClass = "statusbtn combtn";
				if(data.page.list[i].orderSatus){
					status += data.page.list[i].orderSatus;
				}else{
					status += data.page.list[i].ifqsStatus;
				}
				
				if(status == "已取消"){
					statusClass = "statusbtn combtn gray";
				}
				
				for(var j=0;j<data.page.list[i].insurancetTye.length;j++){
					sXz += aXz[data.page.list[i].insurancetTye[j]] + "及";
				}
				sXz = sXz.slice(0,sXz.length-1);
				liHtml += "<li id='" + data.page.list[i].id + "' onClick=\"location.href=\'storelist.html?id=" + data.page.list[i].id + "&status=" + status + "\'\"><div class='carbox'><div class='carimg'></div><p>" + data.page.list[i].carNo + "</p></div><div class='infobox'><p>询价单需求：" + sXz + "；</p><p>提交时间：" + data.page.list[i].createTime + "；</p></div><input type='button' class='" + statusClass + "' value='" + status + "' /></li>";
			}			
			$(".liststatus ul").html(liHtml);
			localStorage.setItem("totalPage", data.page.totalPage);
			console.log(data);      
		}else{baopRequest.bp_alert(data.message,2000);}
	});
	
	// more
	var page = 2;
	$(".viewmore").click(function(){	
		var moreData = "uid=" + localStorage.getItem("uid") + "&page=" + page + "&totalCount=" + localStorage.getItem("totalPage");	
		baopRequest.sendData("inquerySheet/listForPage", moreData, function(data){
			if (data.code == 0) {
				if(page == localStorage.getItem("totalPage")){
					$(".viewmore").hide();
				}
				page++;
				var liHtml = "";
				for(var i=0;i<data.page.list.length;i++){
				var aXz = ["交强险","商业险"], sXz = "";
					for(var j=0;j<data.page.list[i].insurancetTye.length;j++){
						sXz += aXz[data.page.list[i].insurancetTye[j]] + "及";
					}
					sXz = sXz.slice(0,sXz.length-1);
					liHtml += "<li id='" + data.page.list[i].id + "' onClick=\"location.href=\'storelist.html?id=" + data.page.list[i].id + "\'\"><div class='carbox'><div class='carimg'></div><p>" + data.page.list[i].ifqsCarPO.licensePlateNo + "</p></div><div class='infobox'><p>询价单需求：" + sXz + "；</p><p>提交时间：" + data.page.list[i].createTime + "；</p></div><input type='button' class='statusbtn combtn' value='待确认' /></li>";
				}	
				$(".liststatus ul").append(liHtml);
				console.log(data);      
			}else{baopRequest.bp_alert(data.message,2000);}
		});
	});
	 
	 // li click
	 
});
</script>
</body>
</html>