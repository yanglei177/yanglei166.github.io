<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="../images/logo5.ico"/>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <title>上传行驶证</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/base.css">
  </head>
<body class="bg_gray">
    <section class="uploadbox">
    	<h2><span class="bold">温馨提示：</span>由于本地区保险公司要求车主提供行驶本照片才能进行报价，请您按照图片示例上传行驶本正、副页。</h2>
        <div class="list_upload">
        	<div class="jszbox">
            	<p>行驶证正本预览区</p>
            	<input type="button" class="uploadbtn" value="上传行驶证正本" />
                <input type="file" name="file" class="webuploader-element-invisible fileimg" accept="image/*">
                <div class="img_box">
                    <ul></ul>
                </div> 
            </div>
            <div class="example">
            	<div class="examtit">(正页示例)</div>
                <p><img src="../images/jsz1.png" /></p>                
            </div>            
            <div class="clr"></div>            
        </div>
        <div class="list_upload" style="margin-bottom:35px;">
        	<div class="jszbox">
            	<p>行驶证正本预览区</p>
            	<input type="button" class="uploadbtn" value="上传行驶证副本" />
                <input type="file" name="file" class="webuploader-element-invisible fileimg" accept="image/*">
                <div class="img_box">
                    <ul></ul>
                </div> 
            </div>
            <div class="example">
            	<div class="examtit">(副页示例)</div>
                <p><img src="../images/jsz2.png" /></p>
            </div>
            <div class="clr"></div>
        </div>                       
	<div class="sfz_box"></div>
        <p><input type="submit" class="nextbtn" value="下一步" /></p>
    </section>          
<div id="loading">图片正在上传，请稍候...</div>    
<script src="../js/jquery-2.1.4.min.js"></script>
<script src="../js/common.js"></script>
<script type="text/javascript" src="../js/mobileBUGFix.mini.js"></script>
<script type="text/javascript" src="../js/upload.js"></script>
       
        
<script type="text/javascript">
$(function(){
	if(localStorage.getItem("path1")){
		var imgdata1 = JSON.parse(localStorage.getItem("path1"));
		$(".img_box").eq(0).find("ul").append("<li id=" + imgdata1.url + "><img src='" + imgdata1.path + "' ><span name='1' class='clo'>x</span></li>"); 
	}
	
	if(localStorage.getItem("path2")){
		var imgdata2 = JSON.parse(localStorage.getItem("path2"));
		$(".img_box").eq(1).find("ul").append("<li id=" + imgdata2.url + "><img src='" + imgdata2.path + "' ><span name='2' class='clo'>x</span></li>"); 
	}
	
	$(".img_box img").on("load",function(){
		  var w = $(this).width(),
			  h = $(this).height();
		  if(h>w){
			 $(this).css({"width":"h/89*w"+"px","height":"89px"}); 
		  }
	  }); 
	
	$(".nextbtn").click(function(){
		if(baopRequest.getURLParam("url") == "writeinfo"){
			location.href="writeinfo.html";
		}else{
			location.href="select_company.html";
		}		
	});
 });
 //var imgpath = "http://test.ebaoping.com/data/image/";
 $('.fileimg').eq(0).UploadImg({	 
     url : API_URL_ROOT +'upload/uploadImg',
     width : '640',
     //height : '300',
     quality : '0.8', //压缩率，默认值为0.8
     // 如果quality是1 宽和高都未设定 则上传原图
     mixsize : '6',
     bussinessType:'2',
     pictureCount:'2',
     type : [".jpg", ".png", ".JPG", ".PNG",".bmp",".jpeg"],
     before : function(blob,pcUrl){		 
         pictureName=pcUrl;
          var html = "<li id=" + pcUrl + "><img src='" + blob + "' ><span name='1' class='clo'>x</span></li>";		  
          $(".img_box").eq(0).find("ul").append(html);
		  $(".img_box img").on("load",function(){
			  var w = $(this).width(),
				  h = $(this).height();
			  if(h>w){
				 $(this).css({"width":"h/89*w"+"px","height":"89px"}); 
			  }
		  });       
     },
     error : function(res){
         $('#error').html(res);
		 baopRequest.bp_alert("行驶证正本图片上传失败，请重新选择上传。",2000);
     },
     success : function(res){
		 var imgjson = {};
		 imgjson.url = res.url;
		 imgjson.path = IMG_PATH_ROOT + res.url;		 		 
		 localStorage.setItem("path1",JSON.stringify(imgjson));
     }
});

 $('.fileimg').eq(1).UploadImg({	 
     url : API_URL_ROOT +'upload/uploadImg',
     width : '640',
     //height : '300',
     quality : '0.8', //压缩率，默认值为0.8
     // 如果quality是1 宽和高都未设定 则上传原图
     bussinessType:'2',
     mixsize : '6',
     pictureCount:'2',
     type : [".jpg", ".png", ".JPG", ".PNG",".bmp",".jpeg"],
     before : function(blob,pcUrl){		 
         pictureName=pcUrl;
          var html = "<li id=" + pcUrl + "><img src='" + blob + "' ><span name='2' class='clo'>x</span></li>"
          $(".img_box").eq(1).find("ul").append(html); 
		  $(".img_box img").on("load",function(){
			  var w = $(this).width(),
				  h = $(this).height();
			  if(h>w){
				 $(this).css({"width":"h/89*w"+"px","height":"89px"}); 
			  }
		  });         
     },
     error : function(res){
         $('#error').html(res);
		 baopRequest.bp_alert("行驶证正本图片上传失败，请重新选择上传。",2000);
     },
     success : function(res){
		 var imgjson = {};
		 imgjson.url = res.url;
		 imgjson.path = IMG_PATH_ROOT + res.url;		 		 
		 localStorage.setItem("path2",JSON.stringify(imgjson));
     }
});

$(document).delegate("span.clo", "click", function() {
	var index = $(this).attr("name");
	$(this).parents("li").remove();
	if(index == 1){
		localStorage.removeItem("path1");
	}else{
		localStorage.removeItem("path2");
	}
	

});
window.onload = function(){		
	var comhei = $('.example img').height();
	$(".jszbox,.fileimg,.img_box").height(comhei);

	var evt = "onorientationchange" in window ? "orientationchange" : "resize";      
	window.addEventListener(evt, function() {
		var comhei = $('.example img').height();
		$(".jszbox,.fileimg,.img_box").height(comhei);
	}, false);
}
</script>
</body>
</html>