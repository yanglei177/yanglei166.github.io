<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="../images/logo5.ico"/>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <title>新增车辆</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/base.css">
    <style type="text/css">
		.img_box ul{padding:0; width:100%;}
		.img_box ul li{margin-bottom:0;}
	</style>
  </head>
  <body>           
	<section class="bg_gradient bor_no">
    	<div class="comtitle" style="border-top:none;">新增车辆信息</div>
        <div class="infobox">
        <form id="inputForm">
                <ul>
                    <li>
                        <div class="half">
                        	<div class="text_box">
                                <input name="licensePlateNo" type="text" class="text" placeholder="请输入车牌号" />
                            </div>
                            <p class="des"></p>
                        </div>
                        <div class="half">
                        	<div class="text_box">
                                <input name="carOwnerName" type="text" class="text" placeholder="请输入车主姓名"/>
                            </div>           
                            <p class="des"></p>
                        </div>                        
                    </li>
                    <li style="margin-bottom:0;">
                        <div class="text_box">
                            <input  name="carLabel" type="text" class="text" placeholder="请输入车型">
                        </div>
                        <p class="des"></p>
                    </li>
                    <li style="margin-bottom:0;">
                        <div class="text_box">
                            <input  name="frameNo"  type="text" class="text" placeholder="请输入车辆识别代码/车架号" />
                        </div>
                        <p class="des"></p>
                    </li>
                    <li style="margin-bottom:0;">
                        <div class="half">
                        	<div class="text_box">
                                <input type="text" name="engineNo" class="text" placeholder="请输入发动机号" />
                            </div>
                            <p class="des"></p>
                        </div>
                        <div class="half">
                        	<div class="text_box">
                                <input type="text" name="registrationDate" readonly class="text textarr" placeholder="请选择初登日期" />
                                <input type="date" value="2015-08-20" class="datetime" />
                            </div>
                            <p class="des"></p>
                        </div>                        
                    </li>
                    <li style="margin-bottom:0;">
                        <div class="half">
                        	<div class="text_box">
                                <input type="text" name="insuranceExpiryDate" readonly class="text textarr" placeholder="请选择保险到期日" />
                                <input type="date" value="2015-08-20" class="datetime" />
                            </div>
                            <p class="des"></p>
                        </div>
                        <div class="half">
                        	<div class="text_box">
                                <input type="text" name="dringRange" readonly class="text textarr" placeholder="请选择行驶里程" />
                                <select class="select">
                                	<!-- <option>请选择行驶里程</option>  -->
                                    <option>4万公里以下</option>
                                    <option>4-6.9万公里</option>
                                    <option>7-10.9万公里</option>
                                    <option>11-20万公里</option>
                                    <option>20万公里以上</option>
                                </select>
                            </div>
                            <p class="des"></p>
                        </div>                        
                    </li>
                    <li style="margin-bottom:0;">
                    	<p class="orbox" style="padding:0 0 20px;">12个月内是否办理过过户手续
                    		<input type="button" id="isHaving" name="isHaving" class="orbtn on" value="" />
                    		<input type="hidden" id="isHavingAccount" name="isHavingAccount" />                    	
                    	</p>
                    </li>
                    
                    <li style="margin-bottom:20px">
                        <div class="jszbox idcard" style="margin-top:0">
                            <p>行驶证正本预览区</p>
                            <input type="button" class="uploadbtn" value="上传行驶证正本" />
                			<input type="file" style="height:92px;" name="file" class="webuploader-element-invisible fileimg" accept="image/*">
                            <div class="img_box">
			                    <ul></ul>
			                </div> 
			                <input type="hidden" id="drivingLicenseImg" name="drivingLicenseImg" value="" />
                        </div>
                        
                        <div class="jszbox idcard" style="margin-top:0">
                            <p>行驶证副本预览区</p>
                            <input type="button" class="uploadbtn" value="上传行驶证副本">			            	
			                <input type="file" style="height:92px;" name="file" class="webuploader-element-invisible fileimg" accept="image/*">
			                <div class="img_box">
			                    <ul></ul>
			                </div>   
			                <input type="hidden" id="drvingLicenseImgBack" name="drvingLicenseImgBack" value="" />                          
                        </div>
                        <div class="clr"></div>
                    </li>
                                  
                </ul>
                <div class="clr"></div>
                <p><input type="submit" class="nextbtn" value="提交"></p>
            </form>                    
            </div>
            
            
    </section><!-- addcarbox end -->  
    
<div id="loading">图片正在上传，请稍候...</div>  
<script src="../js/jquery-2.1.4.min.js"></script>
<script src="../js/jquery.validate.js"></script>
<script src="../js/common.js"></script>
<script type="text/javascript" src="../js/mobileBUGFix.mini.js"></script>
<script type="text/javascript" src="../js/upload.js"></script>
       
<script type="text/javascript">
$(function(){
	$("#inputForm").validate({
		rules: {
			licensePlateNo: "required",
			carOwnerName:{
				required: true
			},	
			carLabel:{
				required: true
			},	
			frameNo:{
				required: true
			},				
			engineNo:{
				required: true
			},	
			registrationDate:{
				required: true
			}	
		},
		messages: {
			licensePlateNo: {
				required: "请输入车牌"
			},
			carOwnerName:{
				required: "请输入车主姓名"
			},			
			carLabel: {
				required: "请输入车型信息"
			},
			frameNo:{
				required: "请输入车架号"
			},
			engineNo: {
				required: "请输入发动机号"
			},
			registrationDate:{
				required: "请选择初登日期"
			}			
			
		},
		submitHandler:function(){
			var uid = window.localStorage.getItem("uid");//"1";	

			if($("#isHaving").hasClass("on")){
				$("#isHavingAccount").val(1);
			}else{
				$("#isHavingAccount").val(0);
			}
			
			var reqData = $("form").serialize()+"&uid="+uid;	
			baopRequest.sendData("customer/car/add", reqData, 
					function(data){
						baopRequest.bp_alert(data.message,"2500");
						if (data.code == 0) {
							location.href="car_list.html";      
						}else{
						}
					}
			); 
		}
	});
 });
 
 
  //TODO 图片的最大尺寸在哪里限制？
$('.fileimg').eq(0).UploadImg({	 
     url : API_URL_ROOT + 'upload/uploadImg',
     width : '640',
     //height : '300',
     quality : '0.8', //压缩率，默认值为0.8
     // 如果quality是1 宽和高都未设定 则上传原图
     mixsize : '6',
     bussinessType:'1',   //我的车辆的图片
     pictureCount:'2',    //TODO
     type : [".jpg", ".png", ".JPG", ".PNG",".bmp",".jpeg"],
     before : function(blob,pcUrl){		 
         pictureName=pcUrl;
          var html = "<li id=" + pcUrl + "><img src='" + blob + "' ><span name='1' class='clo'>x</span></li>";		  
          $(".img_box").eq(0).find("ul").append(html);  
		  $(".img_box img").on("load",function(){
			  var w = $(this).width(),
				  h = $(this).height();
			  if(h>w){
				 $(this).css({"width":"h/89*w"+"px","height":"89px"}); 
			  }
		  });        
     },
     error : function(res){
         //TODO
         //$('#error').html(res);
		baopRequest.bp_alert("行驶证正本图片上传失败，请重新选择上传。",2000);
     },
     success : function(res){
		 $("#drivingLicenseImg").val(res.url)		 
		 
     }
});

$('.fileimg').eq(1).UploadImg({	 
     url : API_URL_ROOT + 'upload/uploadImg',
     width : '640',
     //height : '300',
     quality : '0.8', //压缩率，默认值为0.8
     // 如果quality是1 宽和高都未设定 则上传原图
     bussinessType:'1',
     mixsize : '6',
     pictureCount:'2',
     type : [".jpg", ".png", ".JPG", ".PNG",".bmp",".jpeg"],
     before : function(blob,pcUrl){		 
         pictureName=pcUrl;
          var html = "<li id=" + pcUrl + "><img src='" + blob + "' ><span name='2' class='clo'>x</span></li>"
          $(".img_box").eq(1).find("ul").append(html);  
		  $(".img_box img").on("load",function(){
			  var w = $(this).width(),
				  h = $(this).height();
			  if(h>w){
				 $(this).css({"width":"h/89*w"+"px","height":"89px"}); 
			  }
		  });        
     },
     error : function(res){
         //TODO
         //$('#error').html(res);
         alert("行驶证副本图片上传失败，请重新选择上传。");
     },
     success : function(res){
    	 $("#drvingLicenseImgBack").val(res.url)
     }
});

$(document).delegate("span.clo", "click", function() {
	var index = $(this).attr("name");
	$(this).parent("li").remove();
	if(index == 1){
		//TODO
		//localStorage.removeItem("path1");
	}else{
		//TODO
		//localStorage.removeItem("path2");
	}
	

});
</script>

</body>
</html>