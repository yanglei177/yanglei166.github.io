<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link rel="shortcut icon" href="../images/logo5.ico"/>
    <meta name="keywords" content="" />
    <meta name="description" content="" />
    <title>绑定保评会员</title>
    <link rel="stylesheet" href="../css/reset.css">
    <link rel="stylesheet" href="../css/base.css">
  </head>
<body>
<form id="inputForm">
    <section class="list_box bg_gradient bor_no">    	
    	<ul class="botline">
        	<li>
                <div class="text_box verifydes">
                	<input type="text" name="mobile" class="tel" placeholder="请输入手机号">
                </div>
                <p class="des"></p>
            </li>
            <li>
                <div class="text_box verifydes">
                	<input type="password" name="pwd" class="text" placeholder="请输入密码">
                </div>
                <p class="des"></p>
            </li>
            <li>
            	<div class="yzm">
                    <div class="text_box verifydes">
                        <input type="text" name="captcha" class="tel"  placeholder="请输入验证码" maxlength="4">
                    </div>
                    <p class="des"></p>
                </div>
                <div class="getyzm"><input type="button" class="combtn" id="getverify" value="获取验证码" /></div><div class="clr"></div>  
            </li>
        </ul>
        
        <div class="btn"><input type="submit" class="combtn" value="绑定" /></div>
    </section><!-- bg_gradient end -->  
    </form>
    <div class="bg_gradient bor_no bg_logo"><img src="../images/bplogo.png" /></div>
<div id="loadingbox"></div>            
<script src="../js/jquery-2.1.4.min.js"></script>
<script src="../js/jquery.validate.js"></script>
<script src="../js/common.js"></script>
<script type="text/javascript">
 $(function(){
	 //是否微信浏览器
	function is_weixin(){
		var ua = navigator.userAgent.toLowerCase();
		if(ua.match(/MicroMessenger/i)=="micromessenger") {
			return true;
		} else {
			return false;
		}
	}
	
	// init wid
	var cache_wid = "";
	if(is_weixin()){
		cache_wid = "&wid=" + localStorage.getItem("cache_wid");
	}
	 
	$("#inputForm").validate({
		rules: {
			mobile: {
				required: true,
				telephone: true
			},
			pwd: {
				required: true,
				minlength: 6
			},
			captcha: {
				required: true,
				minlength: 4,
				maxlength: 4
			},
		},
		messages: {
			mobile: {
				required: "请输入手机号",
				telephone: "请输入正确手机号"
			},
			pwd: {
				required: "请输入密码",
				minlength: jQuery.format("密码不能小于{0}个字 符")
			},
			captcha: {
				required: "请输入验证码",
				maxlength: jQuery.format("验证码不能大于{0}个字 符"),
				minlength: jQuery.format("验证码不能小于{0}个字 符")
			}
		},
		submitHandler:function(form){	
            var reqData = $(form).serialize()+cache_wid;		
            baopRequest.sendData("/customer/bind", reqData, function(data){
				if (data.code == 0) {
					baopRequest.bp_alert("绑定成功!",2000);
					localStorage.setItem("uid",data.uid);	
					localStorage.setItem("wid",data.wid);						
					if(baopRequest.getURLParam("url") != ""){
						location.href = baopRequest.getURLParam("url");
					}else{
						location.href = "index.html";
					}
				}else{
                    baopRequest.bp_alert(data.message,2000);
                }
			})
		}
	});

    //verify
    $("#getverify").click(function() {
    	//todo 必须判断是正规手机号，才能发短信
       var Reg = /^(0|86|17951)?(13[0-9]|15[012356789]|17[678]|18[0-9]|14[57])[0-9]{8}$/;
        if(!Reg.test($("input[name=mobile]").val())){
     	   baopRequest.bp_alert("请填写正确手机号码！",2000);
     	   return;
        }else if($("input[name=mobile]").val() == ""){
			baopRequest.bp_alert("手机号不能为空！",2000);
			return;
		}
    	
       var reqData = {
			"mobile" : $("input[name=mobile]").val(),
			"bizType" : "1"
		};	
		baopRequest.sendData("/customer/sendCaptcha", reqData, function(data){
			if (data.code == 0) {
				baopRequest.bp_alert("验证码已发送，请注意查收!",2000);									
				var i = data.timeouts;
				$(this).addClass('disable').prop("disabled",true).val(i + "s重新获取");
				var timer = setInterval(function(){ 
					i--;
					if(i<=0){
						clearInterval(timer);
						$("#getverify").val("获取验证码").removeClass('disable').prop("disabled",false);
						return;
					}                       
					$("#getverify").val(i + "s重新获取");
				},1000);
			}else{
				baopRequest.bp_alert(data.message,2000);
			}
		})       
    });
 });
</script>

</body>
</html>